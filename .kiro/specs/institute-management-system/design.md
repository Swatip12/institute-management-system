# Design Document

## Overview

The Institute Management System follows a layered Spring Boot architecture with clear separation of concerns. The system uses Spring MVC for REST API endpoints, Spring Data JPA for data access, and H2 database for persistence. The architecture follows standard Spring Boot conventions with Controller-Service-Repository pattern.

## Architecture

```mermaid
graph TB
    A[Frontend - localhost:4200] -->|HTTP/REST| B[AdminController]
    B --> C[AdminService]
    C --> D[Repository Layer]
    D --> E[H2 Database]
    
    subgraph "Spring Boot Application"
        B[AdminController<br/>@RestController]
        C[AdminService<br/>@Service]
        
        subgraph "Repository Layer"
            D1[CourseRepository]
            D2[StudentRepository] 
            D3[MessageRepository]
        end
        
        subgraph "Entity Layer"
            E1[Course Entity]
            E2[Student Entity]
            E3[Message Entity]
        end
    end
```

The system uses a standard 3-tier architecture:
- **Presentation Layer**: REST controllers handling HTTP requests/responses
- **Business Layer**: Service classes containing business logic
- **Data Access Layer**: JPA repositories for database operations

## Components and Interfaces

### Controller Layer

**AdminController**
- Handles all REST API endpoints under `/admin` path
- Implements CORS configuration for frontend access
- Delegates business logic to AdminService
- Returns appropriate HTTP status codes and response bodies

**Key Endpoints:**
- Course Management: GET/POST `/admin/courses`, GET/PUT/DELETE `/admin/courses/{id}`
- Student Access: GET `/admin/students`, GET `/admin/students/{id}`
- Message Access: GET `/admin/messages`, GET `/admin/messages/{id}`

### Service Layer

**AdminService**
- Contains business logic for all administrative operations
- Orchestrates repository calls
- Handles data validation and transformation
- Provides transaction management through Spring's @Transactional

**Key Methods:**
- Course Operations: `getAllCourses()`, `getCourseById()`, `addCourse()`, `updateCourse()`, `deleteCourse()`
- Student Operations: `getAllStudents()`, `getStudentById()`
- Message Operations: `getAllMessages()`, `getMessageById()`

### Repository Layer

**Spring Data JPA Repositories**
- Extend `JpaRepository<Entity, Long>` for automatic CRUD operations
- Provide type-safe database access
- Handle entity lifecycle management
- Support custom query methods if needed

### Entity Layer

**Course Entity**
- `id`: Long (Primary Key, Auto-generated)
- `name`: String (Course name)
- `description`: String (Course description)

**Student Entity**
- `id`: Long (Primary Key, Auto-generated)
- `name`: String (Student name)
- `email`: String (Student email)

**Message Entity**
- `id`: Long (Primary Key, Auto-generated)
- `senderName`: String (Message sender name)
- `email`: String (Sender email)
- `content`: String (Message content)

## Data Models

### Entity Relationships
- No explicit relationships defined between entities in current scope
- Each entity operates independently
- Future enhancements could add relationships (e.g., Student-Course enrollment)

### Database Schema
```sql
-- H2 Database Tables (Auto-generated by JPA)
CREATE TABLE course (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255),
    description VARCHAR(255)
);

CREATE TABLE student (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255),
    email VARCHAR(255)
);

CREATE TABLE message (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    sender_name VARCHAR(255),
    email VARCHAR(255),
    content VARCHAR(255)
);
```

## Error Handling

### HTTP Status Codes
- **200 OK**: Successful GET, PUT operations
- **201 Created**: Successful POST operations
- **204 No Content**: Successful DELETE operations
- **404 Not Found**: Resource not found by ID
- **400 Bad Request**: Invalid request data
- **500 Internal Server Error**: Unexpected server errors

### Exception Handling Strategy
- Use Spring's `@ControllerAdvice` for global exception handling
- Return consistent error response format
- Log errors appropriately for debugging
- Handle JPA exceptions (EntityNotFoundException, DataIntegrityViolationException)

### Error Response Format
```json
{
    "timestamp": "2024-01-01T12:00:00Z",
    "status": 404,
    "error": "Not Found",
    "message": "Course not found with id: 123",
    "path": "/admin/courses/123"
}
```

## Testing Strategy

### Unit Testing
- Test service layer methods with mocked repositories
- Test controller endpoints with MockMvc
- Test entity validation and constraints
- Use JUnit 5 and Mockito for testing framework

### Integration Testing
- Test complete request-response flow
- Use @SpringBootTest with TestRestTemplate
- Test database operations with @DataJpaTest
- Verify CORS configuration with cross-origin requests

### Test Data Management
- Use H2 in-memory database for tests
- Create test data fixtures for consistent testing
- Use @Transactional for test isolation
- Implement data cleanup strategies

## Configuration

### Application Properties
```properties
# Server Configuration
server.port=8080

# H2 Database Configuration
spring.datasource.url=jdbc:h2:mem:testdb
spring.datasource.driverClassName=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=

# JPA Configuration
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
spring.jpa.hibernate.ddl-auto=create-drop
spring.jpa.show-sql=true

# H2 Console (for development)
spring.h2.console.enabled=true
spring.h2.console.path=/h2-console
```

### CORS Configuration
- Allow origins: `http://localhost:4200`
- Allow methods: GET, POST, PUT, DELETE, OPTIONS
- Allow headers: Content-Type, Authorization
- Allow credentials: true

### Maven Dependencies
- Spring Boot Starter Web
- Spring Boot Starter Data JPA
- H2 Database
- Spring Boot Starter Test (for testing)

## Security Considerations

### Current Scope
- No authentication/authorization implemented
- CORS configured for development frontend
- H2 console enabled for development only

### Future Enhancements
- Implement Spring Security for authentication
- Add role-based access control
- Secure H2 console or disable in production
- Add input validation and sanitization
- Implement rate limiting for API endpoints